"use strict";(self.webpackChunkml_4_sim=self.webpackChunkml_4_sim||[]).push([[721],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return h}});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=r.createContext({}),d=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=d(e.components);return r.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},u=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),u=d(n),h=a,m=u["".concat(s,".").concat(h)]||u[h]||c[h]||i;return n?r.createElement(m,o(o({ref:t},p),{},{components:n})):r.createElement(m,o({ref:t},p))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,o=new Array(i);o[0]=u;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:a,o[1]=l;for(var d=2;d<i;d++)o[d]=n[d];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}u.displayName="MDXCreateElement"},687:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return l},contentTitle:function(){return s},metadata:function(){return d},toc:function(){return p},default:function(){return u}});var r=n(7462),a=n(3366),i=(n(7294),n(3905)),o=["components"],l={sidebar_position:3},s="Machine learning workflow",d={unversionedId:"ml_workflow",id:"ml_workflow",title:"Machine learning workflow",description:"Workflow description",source:"@site/docs/ml_workflow.md",sourceDirName:".",slug:"/ml_workflow",permalink:"/docs/ml_workflow",editUrl:"https://github.com/DalilaSalamani/ML4Sim_Documentation.git/docs/ml_workflow.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"Generative modeling",permalink:"/docs/ml_fastsim"},next:{title:"Training and results",permalink:"/docs/ML_Model/training"}},p=[{value:"Workflow description",id:"workflow-description",children:[],level:2},{value:"Dataset description",id:"dataset-description",children:[{value:"Calorimeter setup and mesh definition",id:"calorimeter-setup-and-mesh-definition",children:[],level:3},{value:"Particles, energies and angles",id:"particles-energies-and-angles",children:[],level:3},{value:"Data preprocessing",id:"data-preprocessing",children:[],level:3}],level:2},{value:"Validation",id:"validation",children:[],level:2}],c={toc:p};function u(e){var t=e.components,l=(0,a.Z)(e,o);return(0,i.kt)("wrapper",(0,r.Z)({},c,l,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"machine-learning-workflow"},"Machine learning workflow"),(0,i.kt)("h2",{id:"workflow-description"},"Workflow description"),(0,i.kt)("p",null,"The figure below represents the different componenet of the ML workflow. "),(0,i.kt)("p",null,(0,i.kt)("img",{src:n(8777).Z,width:"2188",height:"1234"})," "),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"The preprocessing module allows us to prepare (data cleaning, scaling,...) the full simulated data generated using Geant4 applications, creating a universal shower representation. It also encodes all condition information (to build conditional generative models) the calorimeter ID, energy of the particle initiating the shower, and the angle at which particles enters the detector. "),(0,i.kt)("li",{parentName:"ul"},"The preprocessed data is then used by the generative model for training. "),(0,i.kt)("li",{parentName:"ul"},"In order to search for the best set of hyperparameters of the model, the optimization module (at training step) is used."),(0,i.kt)("li",{parentName:"ul"},"After training, optimization and validation the model is converted into a format such as JSON or ONNX that can be used for inference in C++ (Geant4 inference). "),(0,i.kt)("li",{parentName:"ul"},"Optimization (at inference step) techniques such as quantization and graph optimizations are used to further reduce the memory footprint of the model at the inference time.  ")),(0,i.kt)("h2",{id:"dataset-description"},"Dataset description"),(0,i.kt)("h3",{id:"calorimeter-setup-and-mesh-definition"},"Calorimeter setup and mesh definition"),(0,i.kt)("p",null,"In our studies, we use simplified and realistic calorimeter geometries. The simplified calorimeter is a setup of concentric cylinders with interchanging layers of materials (active and passive). Energy deposits are scored in the detector using a cylindrical readout structure, centered around the particle momentum, as shown in the figure below. Dimensions of the readout structure are configured w.r.t what the study needs in terms of granularity."),(0,i.kt)("p",null,(0,i.kt)("img",{src:n(6150).Z,width:"1620",height:"852"})," "),(0,i.kt)("p",null,"We use a geometry with layers of silicon and tungsten (",(0,i.kt)("strong",{parentName:"p"},"SiW"),"). Aother geometry is built up with materials of scintillator and lead (",(0,i.kt)("strong",{parentName:"p"},"SciPb"),"). One of the geometries consists of a single material, lead tungstate (",(0,i.kt)("strong",{parentName:"p"},"PbWO4"),"). "),(0,i.kt)("p",null,"For realistic geometries, we use one geometry studied in the context of the electron positron FCC-ee experiment and based on the CLIC detector. This geometry comprises of flat silicon sensors, accompanied with number of materials, most notably tungsten, but also readout and electrode plates, as well as spacing in between layers. In the transverse cross section of the detector flat sensors are placed on octagon."),(0,i.kt)("p",null,"As mentionned in the workflow, particles showerers are simulated with Geant4 (Geant4-app refers to as developping a Geant4 application for particle simulation). In order to register deposited energy at the granularity level independent on the detector readout, we implemented a ",(0,i.kt)("strong",{parentName:"p"},"scoring mesh")," which is not connected to the physical detector segmentation. The advantage of using this mesh is the possibility of defining a high granularity segmentation independently of the angle at which a particle enters the detector. The energy scoring in a mesh works as follow: whenever a particle enters the volume of the calorimeter, its momentum direction is used to define the position and the orientation of the cylindrical readout structure, which is centred around the particle momentum, as shown in the previous figure. The size of the mesh determines the granularity of the produced showers, and can differ for each of the studied geometries. However, the number of mesh cells should remain identical, as it is directly linked to the model design. The cylindrical readout is presented in the figure below. "),(0,i.kt)("p",null,(0,i.kt)("img",{src:n(7951).Z,width:"1088",height:"1172"})),(0,i.kt)("p",null,"Dimensions of the physical detector layers and the mesh readout for the studied geometries are summarised in table below. The number of mesh cells has been optimised to contain on average 95 % of energy of 1 TeV particles."),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Detector"),(0,i.kt)("th",{parentName:"tr",align:null},"Thickness of the active material (mm)"),(0,i.kt)("th",{parentName:"tr",align:null},"Thickness of the passive material (mm)"),(0,i.kt)("th",{parentName:"tr",align:null},"Number of layers"),(0,i.kt)("th",{parentName:"tr",align:null},"R"),(0,i.kt)("th",{parentName:"tr",align:null},"P"),(0,i.kt)("th",{parentName:"tr",align:null},"N"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"SiW"),(0,i.kt)("td",{parentName:"tr",align:null},"0.3"),(0,i.kt)("td",{parentName:"tr",align:null},"1.4"),(0,i.kt)("td",{parentName:"tr",align:null},"90"),(0,i.kt)("td",{parentName:"tr",align:null},"18"),(0,i.kt)("td",{parentName:"tr",align:null},"50"),(0,i.kt)("td",{parentName:"tr",align:null},"45")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"SciPb"),(0,i.kt)("td",{parentName:"tr",align:null},"1.2"),(0,i.kt)("td",{parentName:"tr",align:null},"1.4"),(0,i.kt)("td",{parentName:"tr",align:null},"45"),(0,i.kt)("td",{parentName:"tr",align:null},"18"),(0,i.kt)("td",{parentName:"tr",align:null},"50"),(0,i.kt)("td",{parentName:"tr",align:null},"45")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"PBW04"),(0,i.kt)("td",{parentName:"tr",align:null},"200.25"),(0,i.kt)("td",{parentName:"tr",align:null}),(0,i.kt)("td",{parentName:"tr",align:null},"1"),(0,i.kt)("td",{parentName:"tr",align:null},"18"),(0,i.kt)("td",{parentName:"tr",align:null},"50"),(0,i.kt)("td",{parentName:"tr",align:null},"45")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"SiW FCC-ee"),(0,i.kt)("td",{parentName:"tr",align:null},"0.5"),(0,i.kt)("td",{parentName:"tr",align:null},"1.8"),(0,i.kt)("td",{parentName:"tr",align:null},"40"),(0,i.kt)("td",{parentName:"tr",align:null},"18"),(0,i.kt)("td",{parentName:"tr",align:null},"50"),(0,i.kt)("td",{parentName:"tr",align:null},"45")))),(0,i.kt)("p",null,"In some early studies, different granularities were explored such a segmentation of (24,24,24) or (50,48,120) in (r,","\u03c6",",z)."),(0,i.kt)("h3",{id:"particles-energies-and-angles"},"Particles, energies and angles"),(0,i.kt)("p",null,"For our studies we use different particles, energies and angles. The full simulation samples are showers of electrons and photons generated with an energy range from 1 GeV to 1 TeV (in powers of 2) and angles from 50","\xb0","to 90","\xb0"," (in a step of 10","\xb0","). Entrance angle of 90","\xb0"," means perpendicular to the z-axis. Ten thousand particle showers are simulated for each primary particle energy and angle. "),(0,i.kt)("h3",{id:"data-preprocessing"},"Data preprocessing"),(0,i.kt)("p",null,"The output of the full simulation is a ",(0,i.kt)("a",{parentName:"p",href:"https://root.cern"},"ROOT")," file per energy and angle. Structure of the output file has two branches one containing information collected during the full simulation of particle showers in Geant4 and the second contains histograms of an analysis of shower shapes. In the events branch, information of each cell is stored (energy deposited, r,","\u03c6"," and z) and also the energy of the primary particle. "),(0,i.kt)("p",null,"In order to be able to train the models, the ROOT files are converted into a ML-friendly format ",(0,i.kt)("a",{parentName:"p",href:"https://www.hdfgroup.org/solutions/hdf5/"},"HDF5"),". Dataset of showers are stored as 3D array representing the energy deposition of cells in (r,","\u03c6",",z). The preprocessing component allows us as well to define encoding values of conditional information such as the detector ID, the energy and angle of the incoming particle."),(0,i.kt)("h2",{id:"validation"},"Validation"),(0,i.kt)("p",null,"The validation is used to access the performance of the model. Figues of merit are based on shower observables, which describe shower characteristics and shape. This validation compares distributions of shower observables of full and fast simulation. There are two validation levels: the standalone validation, performed in python within or after the training, is used as a metric to evaluate the generation power of the model. The validation at the inference time, performed within Geant4 in C++ is used to ensure that the fast simulation is accurate after mapping the inferred energies to positions in the calorimeter."),(0,i.kt)("p",null,"Among shower observables, there are the so-called shower profiles, which are calculated as fraction of energy in different parts of the calorimeter. The ",(0,i.kt)("strong",{parentName:"p"},"longitudinal profile")," represents the energy deposited by a shower as a function of the depth of the calorimeter (z-axis). The ",(0,i.kt)("strong",{parentName:"p"},"lateral (transverse) profile")," represents the energy density distribution as function of the radial coordinate.  "),(0,i.kt)("p",null,"Individual profiles may vary significantly, due to the nature of the stochastic process of shower development. This can be see in the figure below where it shows the longitudinal profiles of electromagnetic showers of different energies of eletron particles for 1, 10, 100, 1000, 10 000 GeV.   "),(0,i.kt)("p",null,(0,i.kt)("img",{src:n(9189).Z,width:"2042",height:"1312"})),(0,i.kt)("p",null,"Moments of the longitudinal and transverse profiles can also be used to validate the fast simulation model. Moments used to characterize ameasure the shape of the graph of the function.   Other quantities such as the energy per layer or the total energy are also used for validation purposes. The energy per layer represents the energy sum of deposited energies in one calorimeter layer (along the z-axis). The total energy represents the sum of energy deposited in the calorimeter (all cells in all layers). "),(0,i.kt)("p",null,"Other relevant metrics of validation are the simulation time and the memory footprint of the model. The simulation time refers to the time needed for the full/fast simulation appraoch to run particle simulation in Geant4. The memory footrpint is used to measure the amount of memory needed by the fast simulation model to run the inference.  "),(0,i.kt)("p",null,"To read more:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"FCC collaboration. (2019). FCC Physics Opportunities: Future Circular Collider Conceptual Design Report Volume 1. European Physical Journal C, 79(6), 474."),(0,i.kt)("li",{parentName:"ul"},"FCC collaboration. (2019). FCC-ee: The Lepton Collider: Future Circular Collider Conceptual Design Report Volume 2. European Physical Journal: Special Topics, 228(2), 261-623."),(0,i.kt)("li",{parentName:"ul"},"Arominski, D., Blaising, J. J., Brondolin, E., Dannheim, D., Elsener, K., Gaede, F., ... & Xu, B. (2018). A detector for CLIC: main parameters and performance. arXiv preprint arXiv:1812.07337."),(0,i.kt)("li",{parentName:"ul"},"Dotti, A. (2012). Simplified Calorimeter: shower moments. ",(0,i.kt)("a",{parentName:"li",href:"https://ep-dep-sft.web.cern.ch/sites/default/files/documents/ShowerMoments.pdf"},"URL")," "),(0,i.kt)("li",{parentName:"ul"},"Zaborowska, A. (2017). Calorimetry for the Future Circular Collider experiments (Doctoral dissertation, Warsaw U. of Tech.).")))}u.isMDXComponent=!0},9189:function(e,t,n){t.Z=n.p+"assets/images/AverageLongShowerProfile-a602e1cb05a0fcabbd7fd99ccf7b57ad.png"},8777:function(e,t,n){t.Z=n.p+"assets/images/MLWorkflow-e9142d6c520edea7609583c200db761c.png"},7951:function(e,t,n){t.Z=n.p+"assets/images/Par04_CaloSetup_CaloSegmentation-48ad55e37e108863889b9660349948e3.png"},6150:function(e,t,n){t.Z=n.p+"assets/images/Par04_CaloSetup_EnergyDep-7e62f515aa33b7ab38600a8194f2075c.png"}}]);