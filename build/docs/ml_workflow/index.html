<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.15">
<title data-react-helmet="true">Machine learning workflow | ML4Sim</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://your-docusaurus-test-site.com/docs/ml_workflow"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Machine learning workflow | ML4Sim"><meta data-react-helmet="true" name="description" content="Workflow description"><meta data-react-helmet="true" property="og:description" content="Workflow description"><link data-react-helmet="true" rel="icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://your-docusaurus-test-site.com/docs/ml_workflow"><link data-react-helmet="true" rel="alternate" href="https://your-docusaurus-test-site.com/docs/ml_workflow" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://your-docusaurus-test-site.com/docs/ml_workflow" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.7069df34.css">
<link rel="preload" href="/assets/js/runtime~main.71701159.js" as="script">
<link rel="preload" href="/assets/js/main.f9c432a9.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="Logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/logo.png" alt="Logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">ML4Sim</b></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Get started</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/DalilaSalamani/ML4Sim_Documentation.git" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_Pssr toggle_TdHA toggleDisabled_jDku"><div class="toggleTrack_SSoT" role="button" tabindex="-1"><div class="toggleTrackCheck_XobZ"><span class="toggleIcon_eZtF">ðŸŒœ</span></div><div class="toggleTrackX_YkSC"><span class="toggleIcon_eZtF">ðŸŒž</span></div><div class="toggleTrackThumb_uRm4"></div></div><input type="checkbox" class="toggleScreenReader_JnkT" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y"><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">Full and fast simulation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/ml_fastsim">Generative modeling</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/docs/ml_workflow">Machine learning workflow</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/docs/ML_Model/training">Generative models for fast simulation</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/docs/G4_Inference/from_training_to_inference">Inference integration in Geant4</a></div></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Machine learning workflow</h1><h2 class="anchor anchorWithStickyNavbar_mojV" id="workflow-description">Workflow description<a class="hash-link" href="#workflow-description" title="Direct link to heading">â€‹</a></h2><p>The figure below represents the different componenet of the ML workflow. </p><p><img src="/assets/images/MLWorkflow-e9142d6c520edea7609583c200db761c.png" width="2188" height="1234"> </p><ul><li>The preprocessing module allows us to prepare (data cleaning, scaling,...) the full simulated data generated using Geant4 applications, creating a universal shower representation. It also encodes all condition information (to build conditional generative models) the calorimeter ID, energy of the particle initiating the shower, and the angle at which particles enters the detector. </li><li>The preprocessed data is then used by the generative model for training. </li><li>In order to search for the best set of hyperparameters of the model, the optimization module (at training step) is used.</li><li>After training, optimization and validation the model is converted into a format such as JSON or ONNX that can be used for inference in C++ (Geant4 inference). </li><li>Optimization (at inference step) techniques such as quantization and graph optimizations are used to further reduce the memory footprint of the model at the inference time.  </li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="dataset-description">Dataset description<a class="hash-link" href="#dataset-description" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="calorimeter-setup-and-mesh-definition">Calorimeter setup and mesh definition<a class="hash-link" href="#calorimeter-setup-and-mesh-definition" title="Direct link to heading">â€‹</a></h3><p>In our studies, we use simplified and realistic calorimeter geometries. The simplified calorimeter is a setup of concentric cylinders with interchanging layers of materials (active and passive). Energy deposits are scored in the detector using a cylindrical readout structure, centered around the particle momentum, as shown in the figure below. Dimensions of the readout structure are configured w.r.t what the study needs in terms of granularity.</p><p><img src="/assets/images/Par04_CaloSetup_EnergyDep-7e62f515aa33b7ab38600a8194f2075c.png" width="1620" height="852"> </p><p>We use a geometry with layers of silicon and tungsten (<strong>SiW</strong>). Aother geometry is built up with materials of scintillator and lead (<strong>SciPb</strong>). One of the geometries consists of a single material, lead tungstate (<strong>PbWO4</strong>). </p><p>For realistic geometries, we use one geometry studied in the context of the electron positron FCC-ee experiment and based on the CLIC detector. This geometry comprises of flat silicon sensors, accompanied with number of materials, most notably tungsten, but also readout and electrode plates, as well as spacing in between layers. In the transverse cross section of the detector flat sensors are placed on octagon.</p><p>As mentionned in the workflow, particles showerers are simulated with Geant4 (Geant4-app refers to as developping a Geant4 application for particle simulation). In order to register deposited energy at the granularity level independent on the detector readout, we implemented a <strong>scoring mesh</strong> which is not connected to the physical detector segmentation. The advantage of using this mesh is the possibility of defining a high granularity segmentation independently of the angle at which a particle enters the detector. The energy scoring in a mesh works as follow: whenever a particle enters the volume of the calorimeter, its momentum direction is used to define the position and the orientation of the cylindrical readout structure, which is centred around the particle momentum, as shown in the previous figure. The size of the mesh determines the granularity of the produced showers, and can differ for each of the studied geometries. However, the number of mesh cells should remain identical, as it is directly linked to the model design. The cylindrical readout is presented in the figure below. </p><p><img src="/assets/images/Par04_CaloSetup_CaloSegmentation-48ad55e37e108863889b9660349948e3.png" width="1088" height="1172"></p><p>Dimensions of the physical detector layers and the mesh readout for the studied geometries are summarised in table below. The number of mesh cells has been optimised to contain on average 95 % of energy of 1 TeV particles.</p><table><thead><tr><th>Detector</th><th>Thickness of the active material (mm)</th><th>Thickness of the passive material (mm)</th><th>Number of layers</th><th>R</th><th>P</th><th>N</th></tr></thead><tbody><tr><td>SiW</td><td>0.3</td><td>1.4</td><td>90</td><td>18</td><td>50</td><td>45</td></tr><tr><td>SciPb</td><td>1.2</td><td>1.4</td><td>45</td><td>18</td><td>50</td><td>45</td></tr><tr><td>PBW04</td><td>200.25</td><td></td><td>1</td><td>18</td><td>50</td><td>45</td></tr><tr><td>SiW FCC-ee</td><td>0.5</td><td>1.8</td><td>40</td><td>18</td><td>50</td><td>45</td></tr></tbody></table><p>In some early studies, different granularities were explored such a segmentation of (24,24,24) or (50,48,120) in (r,<!-- -->Ï†<!-- -->,z).</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="particles-energies-and-angles">Particles, energies and angles<a class="hash-link" href="#particles-energies-and-angles" title="Direct link to heading">â€‹</a></h3><p>For our studies we use different particles, energies and angles. The full simulation samples are showers of electrons and photons generated with an energy range from 1 GeV to 1 TeV (in powers of 2) and angles from 50<!-- -->Â°<!-- -->to 90<!-- -->Â°<!-- --> (in a step of 10<!-- -->Â°<!-- -->). Entrance angle of 90<!-- -->Â°<!-- --> means perpendicular to the z-axis. Ten thousand particle showers are simulated for each primary particle energy and angle. </p><h3 class="anchor anchorWithStickyNavbar_mojV" id="data-preprocessing">Data preprocessing<a class="hash-link" href="#data-preprocessing" title="Direct link to heading">â€‹</a></h3><p>The output of the full simulation is a <a href="https://root.cern" target="_blank" rel="noopener noreferrer">ROOT</a> file per energy and angle. Structure of the output file has two branches one containing information collected during the full simulation of particle showers in Geant4 and the second contains histograms of an analysis of shower shapes. In the events branch, information of each cell is stored (energy deposited, r,<!-- -->Ï†<!-- --> and z) and also the energy of the primary particle. </p><p>In order to be able to train the models, the ROOT files are converted into a ML-friendly format <a href="https://www.hdfgroup.org/solutions/hdf5/" target="_blank" rel="noopener noreferrer">HDF5</a>. Dataset of showers are stored as 3D array representing the energy deposition of cells in (r,<!-- -->Ï†<!-- -->,z). The preprocessing component allows us as well to define encoding values of conditional information such as the detector ID, the energy and angle of the incoming particle.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="validation">Validation<a class="hash-link" href="#validation" title="Direct link to heading">â€‹</a></h2><p>The validation is used to access the performance of the model. Figues of merit are based on shower observables, which describe shower characteristics and shape. This validation compares distributions of shower observables of full and fast simulation. There are two validation levels: the standalone validation, performed in python within or after the training, is used as a metric to evaluate the generation power of the model. The validation at the inference time, performed within Geant4 in C++ is used to ensure that the fast simulation is accurate after mapping the inferred energies to positions in the calorimeter.</p><p>Among shower observables, there are the so-called shower profiles, which are calculated as fraction of energy in different parts of the calorimeter. The <strong>longitudinal profile</strong> represents the energy deposited by a shower as a function of the depth of the calorimeter (z-axis). The <strong>lateral (transverse) profile</strong> represents the energy density distribution as function of the radial coordinate.  </p><p>Individual profiles may vary significantly, due to the nature of the stochastic process of shower development. This can be see in the figure below where it shows the longitudinal profiles of electromagnetic showers of different energies of eletron particles for 1, 10, 100, 1000, 10 000 GeV.   </p><p><img src="/assets/images/AverageLongShowerProfile-a602e1cb05a0fcabbd7fd99ccf7b57ad.png" width="2042" height="1312"></p><p>Moments of the longitudinal and transverse profiles can also be used to validate the fast simulation model. Moments used to characterize ameasure the shape of the graph of the function.   Other quantities such as the energy per layer or the total energy are also used for validation purposes. The energy per layer represents the energy sum of deposited energies in one calorimeter layer (along the z-axis). The total energy represents the sum of energy deposited in the calorimeter (all cells in all layers). </p><p>Other relevant metrics of validation are the simulation time and the memory footprint of the model. The simulation time refers to the time needed for the full/fast simulation appraoch to run particle simulation in Geant4. The memory footrpint is used to measure the amount of memory needed by the fast simulation model to run the inference.  </p><p>To read more:</p><ul><li>FCC collaboration. (2019). FCC Physics Opportunities: Future Circular Collider Conceptual Design Report Volume 1. European Physical Journal C, 79(6), 474.</li><li>FCC collaboration. (2019). FCC-ee: The Lepton Collider: Future Circular Collider Conceptual Design Report Volume 2. European Physical Journal: Special Topics, 228(2), 261-623.</li><li>Arominski, D., Blaising, J. J., Brondolin, E., Dannheim, D., Elsener, K., Gaede, F., ... &amp; Xu, B. (2018). A detector for CLIC: main parameters and performance. arXiv preprint arXiv:1812.07337.</li><li>Dotti, A. (2012). Simplified Calorimeter: shower moments. <a href="https://ep-dep-sft.web.cern.ch/sites/default/files/documents/ShowerMoments.pdf" target="_blank" rel="noopener noreferrer">URL</a> </li><li>Zaborowska, A. (2017). Calorimetry for the Future Circular Collider experiments (Doctoral dissertation, Warsaw U. of Tech.).</li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/DalilaSalamani/ML4Sim_Documentation.git/docs/ml_workflow.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/ml_fastsim"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Generative modeling</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/ML_Model/training"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Training and results</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#workflow-description" class="table-of-contents__link toc-highlight">Workflow description</a></li><li><a href="#dataset-description" class="table-of-contents__link toc-highlight">Dataset description</a><ul><li><a href="#calorimeter-setup-and-mesh-definition" class="table-of-contents__link toc-highlight">Calorimeter setup and mesh definition</a></li><li><a href="#particles-energies-and-angles" class="table-of-contents__link toc-highlight">Particles, energies and angles</a></li><li><a href="#data-preprocessing" class="table-of-contents__link toc-highlight">Data preprocessing</a></li></ul></li><li><a href="#validation" class="table-of-contents__link toc-highlight">Validation</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Get started</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://indico.cern.ch/category/13860/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>ML4Sim<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://mattermost.web.cern.ch/ml4sim/channels/town-square" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Mattermost<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/DalilaSalamani/ML4Sim_Documentation.git" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022, CERN</div></div></div></footer></div>
<script src="/assets/js/runtime~main.71701159.js"></script>
<script src="/assets/js/main.f9c432a9.js"></script>
</body>
</html>